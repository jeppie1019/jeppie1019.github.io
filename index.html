<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸ç¨ - è—è‰²å¤œç©ºè–èª•ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        :root {
            /* --- ä¿®æ”¹è™•ï¼šèƒŒæ™¯é¡è‰²æ”¹ç‚ºè—è‰²æ¼¸å±¤ --- */
            --bg-gradient: radial-gradient(circle at center, #4a69bd 0%, #2c3e50 100%);
            /* --- ä¿®æ”¹è™•ï¼šå®¹å™¨ç¨å¾®é€æ˜ä¸€é»é»ï¼Œè®“èƒŒæ™¯é€å‡ºä¾†æ›´æœ‰å±¤æ¬¡æ„Ÿ --- */
            --container-bg: rgba(255, 255, 255, 0.95);
            --grid-size: 450px;
            --cell-size: 50px;
            --thick-border: 4px solid #000;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* --- ä¿®æ”¹è™•ï¼šä½¿ç”¨ background å±¬æ€§ä»¥æ”¯æŒæ¼¸å±¤ --- */
            background: var(--bg-gradient);
            margin: 0;
            overflow: hidden;
            transition: background 0.8s ease, transform 0.1s;
        }

        body.victory-bg { background: #2ecc71 !important; }

        /* ç­”éŒ¯éœ‡å‹• */
        .shake-screen { animation: screen-shake 0.12s ease-in-out infinite; }
        @keyframes screen-shake {
            0% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
            100% { transform: translate(2px, 2px); }
        }

        .container {
            text-align: center;
            background: var(--container-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            position: relative;
            z-index: 10; /* å®¹å™¨å±¤ç´šè¼ƒä½ */
            transition: transform 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(5px); /* å¢åŠ ä¸€é»æ¯›ç»ç’ƒæ•ˆæœ */
        }

        .rotate-win { transform: rotate(720deg) scale(1.05); }

        h1 { 
            color: #1a1a1a; 
            font-size: 3rem;
            margin: 0 0 15px 0; 
            letter-spacing: 10px;
            font-weight: 900;
        }

        /* æ•¸ç¨ç›¤é¢ */
        .grid {
            display: grid;
            grid-template-columns: repeat(9, var(--cell-size));
            grid-template-rows: repeat(9, var(--cell-size));
            width: var(--grid-size);
            height: var(--grid-size);
            border: var(--thick-border); 
            margin: 0 auto;
            background-color: #bbb; 
            gap: 1px;
            box-sizing: content-box;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px; 
            font-weight: 800;
            cursor: pointer;
            background-color: #fff;
            user-select: none;
            outline: none;
            box-sizing: border-box;
        }

        /* --- ä¹å®®æ ¼åŠ æ·±ç·šæ¢ --- */
        .cell:nth-child(3n) { border-right: 3px solid #000; }
        .cell:nth-child(9n) { border-right: none; }
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 3px solid #000; }

        .cell.fixed { background-color: #f5f5f5; color: #666; cursor: default; }
        .cell.error { background-color: #ff5252 !important; color: #fff !important; }

        /* ç‰¹æ•ˆå±¤ */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #blood-overlay { background: radial-gradient(circle, rgba(255,0,0,0) 40%, rgba(200,0,0,0.7) 100%); z-index: 150; opacity: 0; transition: opacity 0.1s; }
        #taunt-overlay { background: rgba(0,0,0,0.9); z-index: 200; opacity: 0; display: flex; justify-content: center; align-items: center; transition: opacity 0.3s; }
        .taunt-text { font-size: 10vw; color: white; font-weight: 900; text-shadow: 0 0 20px red; }

        /* è–èª•è€äººå±¤ç´šè¨­å®š (z-index: 100, æ¯”å®¹å™¨çš„ 10 é«˜ï¼Œæ‰€ä»¥æœƒåœ¨å‰é¢é£›) */
        .santa-sleigh { position: absolute; left: -150px; font-size: 60px; z-index: 100; }
        .gift-item { position: absolute; font-size: 30px; z-index: 101; animation: drop 3s linear forwards; }
        @keyframes drop {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(105vh) rotate(540deg); opacity: 0; }
        }

        .controls { margin-top: 20px; }
        button {
            padding: 10px 25px; font-size: 18px; font-weight: bold; margin: 5px;
            cursor: pointer; border: none; border-radius: 8px; transition: 0.2s;
        }
        #solve-button { background: #ff5252; color: white; }
        #new-game-button { background: #4caf50; color: white; }
        button:hover { filter: brightness(1.2); transform: translateY(-2px); }
    </style>
</head>
<body>

    <div class="container">
        <h1>æ•¸ ç¨</h1>
        <div id="sudoku-grid" class="grid"></div>
        <div class="controls">
            <button id="solve-button">è‡ªå‹•æ±‚è§£</button>
            <button id="new-game-button">æ–°éŠæˆ²</button>
        </div>
        <p id="message" style="font-size: 1.2rem; margin-top: 15px; font-weight: bold; color: #333;"></p>
    </div>

    <div id="blood-overlay" class="overlay"></div>
    <div id="taunt-overlay" class="overlay"><div class="taunt-text">å¤ªå«©äº†å§ï¼</div></div>
    <div id="celebration-overlay" class="overlay"></div>

    <script>
        const gridElement = document.getElementById('sudoku-grid');
        const bloodOverlay = document.getElementById('blood-overlay');
        const tauntOverlay = document.getElementById('taunt-overlay');
        const celebrationOverlay = document.getElementById('celebration-overlay');
        const container = document.querySelector('.container');
        const messageElement = document.getElementById('message');

        let initialGrid = [], currentGrid = [];
        const COLORS = ['#FFD700', '#FF69B4', '#00FFFF', '#ADFF2F', '#FF4500'];
        const ITEMS = ['ğŸ', 'â­', 'ğŸŒ™', 'âœ¨', 'ğŸ­', 'â„ï¸'];

        // æ ¸å¿ƒæª¢æŸ¥é‚è¼¯
        function isValid(board, r, c, n) {
            if (n === 0) return true;
            for (let i = 0; i < 9; i++) {
                if (i !== c && board[r][i] === n) return false;
                if (i !== r && board[i][c] === n) return false;
            }
            let rs = Math.floor(r / 3) * 3, cs = Math.floor(c / 3) * 3;
            for (let i = rs; i < rs + 3; i++) {
                for (let j = cs; j < cs + 3; j++) {
                    if ((i !== r || j !== c) && board[i][j] === n) return false;
                }
            }
            return true;
        }

        function solveSudoku(board) {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (board[r][c] === 0) {
                        let nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                        for (let n of nums) {
                            if (isValid(board, r, c, n)) {
                                board[r][c] = n;
                                if (solveSudoku(board)) return true;
                                board[r][c] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function initGame() {
            container.classList.remove('rotate-win');
            document.body.classList.remove('victory-bg');
            messageElement.textContent = "";
            let b = Array(9).fill(0).map(() => Array(9).fill(0));
            solveSudoku(b);
            
            // æŒ–æ´é‡
            for (let i = 0; i < 42; i++) {
                let r = Math.floor(Math.random() * 9), c = Math.floor(Math.random() * 9);
                b[r][c] = 0;
            }
            
            initialGrid = b.map(row => [...row]);
            currentGrid = b.map(row => [...row]);
            render();
        }

        function render() {
            gridElement.innerHTML = '';
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell' + (initialGrid[r][c] !== 0 ? ' fixed' : '');
                    cell.textContent = currentGrid[r][c] !== 0 ? currentGrid[r][c] : '';
                    if (initialGrid[r][c] === 0) {
                        cell.contentEditable = true;
                        cell.oninput = (e) => handleInput(e, r, c);
                    }
                    gridElement.appendChild(cell);
                }
            }
        }

        function handleInput(e, r, c) {
            const char = e.target.textContent.slice(-1);
            const val = parseInt(char);
            
            if (isNaN(val) || val === 0) {
                e.target.textContent = "";
                currentGrid[r][c] = 0;
                e.target.classList.remove('error');
                return;
            }
            
            e.target.textContent = val;
            currentGrid[r][c] = val; 

            if (!isValid(currentGrid, r, c, val)) {
                e.target.classList.add('error');
                triggerBlood();
            } else {
                e.target.classList.remove('error');
            }
            checkWin();
        }

        function triggerBlood() {
            document.body.classList.add('shake-screen');
            bloodOverlay.style.opacity = '1';
            setTimeout(() => {
                document.body.classList.remove('shake-screen');
                bloodOverlay.style.opacity = '0';
            }, 250);
        }

        function checkWin() {
            for(let r=0; r<9; r++) {
                for(let c=0; c<9; c++) {
                    if(currentGrid[r][c] === 0 || !isValid(currentGrid, r, c, currentGrid[r][c])) return;
                }
            }
            startCelebration();
        }

        function startCelebration() {
            document.body.classList.add('victory-bg');
            container.classList.add('rotate-win');
            messageElement.textContent = "ğŸ† å‹åˆ©ï¼æ¥å—è–èª•è€äººçš„æ´—ç¦®å§ï¼";
            celebrationOverlay.style.display = 'block';
            
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });

            for (let i = 0; i < 10; i++) {
                const santa = document.createElement('div');
                santa.className = 'santa-sleigh';
                santa.textContent = 'ğŸ…ğŸ»';
                santa.style.top = (Math.random() * 70) + 'vh';
                const speed = 7 + Math.random() * 4;
                const delay = Math.random() * 3;
                santa.style.transition = `left ${speed}s linear ${delay}s`;
                celebrationOverlay.appendChild(santa);

                let giftTimer = setInterval(() => {
                    const rect = santa.getBoundingClientRect();
                    if (rect.left > window.innerWidth) return clearInterval(giftTimer);
                    
                    const gift = document.createElement('div');
                    gift.className = 'gift-item';
                    gift.textContent = ITEMS[Math.floor(Math.random() * ITEMS.length)];
                    gift.style.left = (rect.left + 50) + 'px';
                    gift.style.top = rect.top + 'px';
                    gift.style.color = COLORS[Math.floor(Math.random() * COLORS.length)];
                    celebrationOverlay.appendChild(gift);
                }, 200);

                setTimeout(() => { santa.style.left = '120vw'; }, 100);
            }
        }

        document.getElementById('solve-button').onclick = () => {
            tauntOverlay.style.opacity = '1';
            setTimeout(() => {
                tauntOverlay.style.opacity = '0';
                currentGrid = initialGrid.map(row => [...row]);
                solveSudoku(currentGrid);
                render();
                messageElement.textContent = "çœŸçš„å«©åˆ°å‡ºæ±ã€‚";
            }, 1000);
        };

        document.getElementById('new-game-button').onclick = initGame;

        initGame();
    </script>
</body>
</html>
