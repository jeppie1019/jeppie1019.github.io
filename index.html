<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸ç¨ - æ¥µè‡´æ•´é½Šç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        :root {
            --bg-gradient: radial-gradient(circle at center, #3c6382 0%, #0a3d62 100%);
            --container-bg: rgba(255, 255, 255, 1);
            --cell-size: 52px;  
            --bold-line: 4px solid #000; /* ä¹å®®æ ¼åŠ æ·±ç·šæ¢ */
            --thin-line: 1px solid #ccc; /* æ™®é€šåˆ†éš”ç·šæ¢ */
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--bg-gradient);
            margin: 0;
            overflow: hidden;
            transition: background 0.8s ease;
        }

        body.victory-bg { background: #27ae60 !important; }

        .container {
            text-align: center;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.7);
            position: relative;
            z-index: 10; 
            transition: transform 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .rotate-win { transform: rotate(720deg) scale(1.05); }

        h1 { color: #2c3e50; font-size: 2.5rem; margin: 0 0 20px 0; letter-spacing: 8px; font-weight: 900; }

        /* --- æ ¸å¿ƒä¿®æ­£ï¼šæ¥µè‡´æ•´é½Šçš„é‚Šæ¡†è¨­è¨ˆ --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(9, var(--cell-size));
            grid-template-rows: repeat(9, var(--cell-size));
            border: var(--bold-line); /* æœ€å¤–å±¤å¤§æ¡† */
            background-color: #fff;
            margin: 0 auto;
            user-select: none;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px; 
            font-weight: 800;
            cursor: pointer;
            border: var(--thin-line);
            box-sizing: border-box; /* ç¢ºä¿é‚Šæ¡†ä¸å½±éŸ¿æ ¼å­å¤§å° */
            outline: none;
        }

        /* ç¸±å‘åŠ æ·±ï¼šæ¯ä¸‰æ¬„å³é‚ŠåŠ ç²— */
        .cell:nth-child(3n) { border-right: var(--bold-line); }
        .cell:nth-child(9n) { border-right: none; } /* æœ€å³é‚Šä¸é‡è¤‡åŠ ç²— */

        /* æ©«å‘åŠ æ·±ï¼šç¬¬ 3ã€6 åˆ—åº•éƒ¨åŠ ç²— */
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: var(--bold-line); }

        .cell.fixed { background-color: #f8f9fa; color: #7f8c8d; cursor: default; }
        .cell.error { background-color: #ff4757 !important; color: #fff !important; }

        /* ğŸ‘ é»‘è‰²è®šæ‰è½ */
        .thumbs-up {
            position: fixed; top: -80px; font-size: 70px; color: #000;
            z-index: 1000; pointer-events: none;
            animation: thumbs-drop 1.2s ease-in forwards;
        }
        @keyframes thumbs-drop {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(-15deg); opacity: 0; }
        }

        /* ğŸ… è–èª•è€äººå±¤ (Z-INDEX è¨­ç‚ºæœ€é«˜) */
        #celebration-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999 !important; }
        .santa-sleigh { position: absolute; left: -150px; font-size: 80px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3)); }
        .gift-item { position: absolute; font-size: 40px; animation: drop-anim 3s linear forwards; }

        @keyframes drop-anim {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        /* å…¶ä»–ç‰¹æ•ˆ */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #blood-overlay { background: radial-gradient(circle, rgba(255,0,0,0) 40%, rgba(255,0,0,0.6) 100%); z-index: 50; opacity: 0; transition: opacity 0.1s; }
        .shake-screen { animation: screen-shake 0.1s infinite; }
        @keyframes screen-shake { 0%, 100% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } }

        .controls { margin-top: 25px; }
        button { padding: 12px 25px; font-size: 18px; font-weight: bold; margin: 8px; cursor: pointer; border: none; border-radius: 8px; transition: 0.2s; }
        #solve-button { background: #ff4757; color: white; }
        #new-game-button { background: #1e90ff; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <h1>æ•¸ ç¨</h1>
        <div id="sudoku-grid" class="grid"></div>
        <div class="controls">
            <button id="solve-button">è‡ªå‹•æ±‚è§£</button>
            <button id="new-game-button">æ–°éŠæˆ²</button>
        </div>
        <p id="message" style="font-size: 1.2rem; margin-top: 15px; font-weight: bold; color: #2f3542;"></p>
    </div>

    <div id="blood-overlay" class="overlay"></div>
    <div id="celebration-overlay"></div>

    <script>
        const gridElement = document.getElementById('sudoku-grid');
        const bloodOverlay = document.getElementById('blood-overlay');
        const celebrationOverlay = document.getElementById('celebration-overlay');
        const container = document.querySelector('.container');
        const messageElement = document.getElementById('message');

        let initialGrid = [], currentGrid = [];
        const COLORS = ['#FFD700', '#FF69B4', '#00FFFF', '#ADFF2F', '#FF4500'];
        const ITEMS = ['ğŸ', 'â­', 'ğŸŒ™', 'âœ¨', 'ğŸ­', 'â„ï¸'];

        function isValid(board, r, c, n) {
            if (n === 0) return true;
            for (let i = 0; i < 9; i++) {
                if (i !== c && board[r][i] === n) return false;
                if (i !== r && board[i][c] === n) return false;
            }
            let rs = Math.floor(r / 3) * 3, cs = Math.floor(c / 3) * 3;
            for (let i = rs; i < rs + 3; i++) {
                for (let j = cs; j < cs + 3; j++) {
                    if ((i !== r || j !== c) && board[i][j] === n) return false;
                }
            }
            return true;
        }

        function solveSudoku(board) {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (board[r][c] === 0) {
                        let nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                        for (let n of nums) {
                            if (isValid(board, r, c, n)) {
                                board[r][c] = n;
                                if (solveSudoku(board)) return true;
                                board[r][c] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function triggerThumbsUp() {
            const thumbs = document.createElement('div');
            thumbs.className = 'thumbs-up';
            thumbs.textContent = 'ğŸ‘';
            thumbs.style.left = Math.random() * 90 + 'vw';
            document.body.appendChild(thumbs);
            setTimeout(() => thumbs.remove(), 1200);
        }

        function triggerBlood() {
            document.body.classList.add('shake-screen');
            bloodOverlay.style.opacity = '1';
            setTimeout(() => {
                document.body.classList.remove('shake-screen');
                bloodOverlay.style.opacity = '0';
            }, 200);
        }

        function initGame() {
            container.classList.remove('rotate-win');
            document.body.classList.remove('victory-bg');
            celebrationOverlay.innerHTML = '';
            messageElement.textContent = "";
            let b = Array(9).fill(0).map(() => Array(9).fill(0));
            solveSudoku(b);
            for (let i = 0; i < 40; i++) {
                let r = Math.floor(Math.random() * 9), c = Math.floor(Math.random() * 9);
                b[r][c] = 0;
            }
            initialGrid = b.map(row => [...row]);
            currentGrid = b.map(row => [...row]);
            render();
        }

        function render() {
            gridElement.innerHTML = '';
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell' + (initialGrid[r][c] !== 0 ? ' fixed' : '');
                    cell.textContent = currentGrid[r][c] !== 0 ? currentGrid[r][c] : '';
                    if (initialGrid[r][c] === 0) {
                        cell.contentEditable = true;
                        cell.oninput = (e) => handleInput(e, r, c);
                    }
                    gridElement.appendChild(cell);
                }
            }
        }

        function handleInput(e, r, c) {
            const char = e.target.textContent.slice(-1);
            const val = parseInt(char);
            if (isNaN(val) || val === 0) {
                e.target.textContent = "";
                currentGrid[r][c] = 0;
                e.target.classList.remove('error');
                return;
            }
            e.target.textContent = val;
            currentGrid[r][c] = val; 

            if (!isValid(currentGrid, r, c, val)) {
                e.target.classList.add('error');
                triggerBlood();
            } else {
                e.target.classList.remove('error');
                triggerThumbsUp();
            }
            checkWin();
        }

        function checkWin() {
            for(let r=0; r<9; r++) for(let c=0; c<9; c++) 
                if(currentGrid[r][c] === 0 || !isValid(currentGrid, r, c, currentGrid[r][c])) return;
            startCelebration();
        }

        function startCelebration() {
            document.body.classList.add('victory-bg');
            container.classList.add('rotate-win');
            messageElement.textContent = "ğŸ„ è–èª•å¿«æ¨‚ï¼å¯¦åŠ›é©šäººï¼ ğŸ„";
            confetti({ particleCount: 250, spread: 90, origin: { y: 0.6 } });

            for (let i = 0; i < 10; i++) {
                const santa = document.createElement('div');
                santa.className = 'santa-sleigh';
                santa.textContent = 'ğŸ…ğŸ»';
                santa.style.top = (Math.random() * 80) + 'vh';
                const speed = 6 + Math.random() * 4;
                const delay = Math.random() * 3;
                santa.style.transition = `left ${speed}s linear ${delay}s`;
                celebrationOverlay.appendChild(santa);

                let giftTimer = setInterval(() => {
                    const rect = santa.getBoundingClientRect();
                    if (rect.left > window.innerWidth) return clearInterval(giftTimer);
                    const gift = document.createElement('div');
                    gift.className = 'gift-item';
                    gift.textContent = ITEMS[Math.floor(Math.random() * ITEMS.length)];
                    gift.style.left = (rect.left + 60) + 'px';
                    gift.style.top = rect.top + 'px';
                    gift.style.color = COLORS[Math.floor(Math.random() * COLORS.length)];
                    celebrationOverlay.appendChild(gift);
                }, 250);
                setTimeout(() => { santa.style.left = '120vw'; }, 100);
            }
        }

        document.getElementById('solve-button').onclick = () => {
            currentGrid = initialGrid.map(row => [...row]);
            solveSudoku(currentGrid);
            render();
            messageElement.textContent = "è‡ªå‹•å®Œæˆï¼Œä½†ä½ è®Šå«©äº†ã€‚";
        };

        document.getElementById('new-game-button').onclick = initGame;
        initGame();
    </script>
</body>
</html>
