<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸ç¨ - çµ‚æ¥µéœ¸æ°£ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --container-bg: #ffffff;
            --grid-size: 630px; /* ç›¤é¢åŠ å¤§ */
            --cell-size: 70px;  /* æ ¼å­åŠ å¤§ */
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            margin: 0;
            overflow: hidden;
            transition: transform 0.1s;
        }

        /* ç­”éŒ¯æµè¡€éœ‡å‹• */
        .shake-screen { animation: screen-shake 0.1s ease-in-out infinite; }
        @keyframes screen-shake {
            0% { transform: translate(3px, 3px) rotate(0deg); }
            50% { transform: translate(-3px, -3px) rotate(-1deg); }
            100% { transform: translate(3px, 3px) rotate(1deg); }
        }

        .container {
            text-align: center;
            background: var(--container-bg);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            transition: transform 2s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        /* ç­”å°å¤§æ—‹è½‰ */
        .rotate-win { transform: rotate(1080deg) scale(1.2); }

        h1 { 
            color: #1a1a1a; 
            font-size: 5rem; /* æ¨™é¡Œè¶…å¤§ */
            margin: 0 0 20px 0; 
            letter-spacing: 20px;
            text-shadow: 5px 5px 0px #eee;
        }

        /* æ•¸ç¨å¤§ç›¤é¢ */
        .grid {
            display: grid;
            grid-template-columns: repeat(9, var(--cell-size));
            grid-template-rows: repeat(9, var(--cell-size));
            width: var(--grid-size);
            height: var(--grid-size);
            border: 5px solid #000;
            margin: 0 auto;
            background-color: #000;
            gap: 1px;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px; /* æ•¸å­—åŠ å¤§ */
            font-weight: 900;
            cursor: pointer;
            background-color: #fff;
            user-select: none;
            outline: none;
            transition: background 0.2s;
        }

        /* ä¹å®®æ ¼åŠ ç²—é‚Šç•Œ */
        .cell:nth-child(3n) { border-right: 4px solid #000; }
        .cell:nth-child(9n) { border-right: none; }
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 4px solid #000; }

        .cell:hover { background-color: #f0f0f0; }
        .cell.fixed { background-color: #e0e0e0; color: #333; cursor: default; }
        .cell.error { background-color: #ff4d4d !important; color: #fff !important; }

        /* ç‰¹æ•ˆç–Šå±¤ */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        #blood-overlay { background: radial-gradient(circle, rgba(255,0,0,0) 30%, rgba(150,0,0,0.8) 100%); z-index: 150; opacity: 0; transition: opacity 0.1s; }
        
        #taunt-overlay { 
            background: rgba(0,0,0,0.95); z-index: 200; opacity: 0; 
            display: flex; justify-content: center; align-items: center; transition: opacity 0.3s;
        }
        .taunt-text { font-size: 15vw; color: red; font-weight: 900; text-shadow: 0 0 50px red; }

        /* è–èª•è€äºº */
        .santa-sleigh { position: absolute; left: -200px; font-size: 80px; z-index: 100; }
        .gift-item { position: absolute; font-size: 40px; z-index: 101; animation: drop 3s linear forwards; }
        @keyframes drop {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        /* æŒ‰éˆ• */
        .controls { margin-top: 30px; }
        button {
            padding: 15px 40px; font-size: 24px; font-weight: bold; margin: 0 10px;
            cursor: pointer; border: none; border-radius: 10px; transition: 0.3s;
        }
        #solve-button { background: #ff4757; color: white; }
        #new-game-button { background: #2ed573; color: white; }
        button:hover { transform: scale(1.1); filter: brightness(1.2); }
    </style>
</head>
<body>

    <div class="container">
        <h1>æ•¸ ç¨</h1>
        <div id="sudoku-grid" class="grid"></div>
        <div class="controls">
            <button id="solve-button">è‡ªå‹•æ±‚è§£</button>
            <button id="new-game-button">æ–°éŠæˆ²</button>
        </div>
        <p id="message" style="font-size: 1.5rem; margin-top: 20px; font-weight: bold;"></p>
    </div>

    <div id="blood-overlay" class="overlay"></div>
    <div id="taunt-overlay" class="overlay"><div class="taunt-text">ä½ è¶…å«©ï¼</div></div>
    <div id="celebration-overlay" class="overlay"></div>

    <script>
        const gridElement = document.getElementById('sudoku-grid');
        const bloodOverlay = document.getElementById('blood-overlay');
        const tauntOverlay = document.getElementById('taunt-overlay');
        const celebrationOverlay = document.getElementById('celebration-overlay');
        const container = document.querySelector('.container');
        const messageElement = document.getElementById('message');

        let initialGrid = [], currentGrid = [];
        const COLORS = ['#FFD700', '#FF69B4', '#00FFFF', '#ADFF2F', '#FF4500', '#FFFFFF'];
        const ITEMS = ['ğŸ', 'â­', 'ğŸŒ™', 'ğŸ„', 'âœ¨', 'ğŸ­'];

        // æ•¸ç¨é‚è¼¯
        function isValid(board, r, c, n) {
            for (let i = 0; i < 9; i++) if (board[r][i] === n || board[i][c] === n) return false;
            let rs = Math.floor(r / 3) * 3, cs = Math.floor(c / 3) * 3;
            for (let i = 0; i < 3; i++) for (let j = 0; j < 3; j++) if (board[rs + i][cs + j] === n) return false;
            return true;
        }

        function solveSudoku(board) {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (board[r][c] === 0) {
                        for (let n = 1; n <= 9; n++) {
                            if (isValid(board, r, c, n)) {
                                board[r][c] = n;
                                if (solveSudoku(board)) return true;
                                board[r][c] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function initGame() {
            container.classList.remove('rotate-win');
            messageElement.textContent = "";
            let b = Array(9).fill(0).map(() => Array(9).fill(0));
            solveSudoku(b); // ç”Ÿæˆå®Œæ•´ç›¤é¢
            
            // éš¨æ©ŸæŒ–æ´ (é›£åº¦)
            for (let i = 0; i < 45; i++) {
                let r = Math.floor(Math.random() * 9), c = Math.floor(Math.random() * 9);
                b[r][c] = 0;
            }
            
            initialGrid = b.map(row => [...row]);
            currentGrid = b.map(row => [...row]);
            render();
        }

        function render() {
            gridElement.innerHTML = '';
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell' + (initialGrid[r][c] !== 0 ? ' fixed' : '');
                    cell.textContent = currentGrid[r][c] !== 0 ? currentGrid[r][c] : '';
                    if (initialGrid[r][c] === 0) {
                        cell.contentEditable = true;
                        cell.oninput = (e) => handleInput(e, r, c);
                    }
                    gridElement.appendChild(cell);
                }
            }
        }

        function handleInput(e, r, c) {
            const val = parseInt(e.target.textContent.slice(-1));
            if (isNaN(val) || val === 0) {
                e.target.textContent = "";
                currentGrid[r][c] = 0;
                return;
            }
            e.target.textContent = val;
            
            if (!isValid(currentGrid, r, c, val)) {
                e.target.classList.add('error');
                triggerBlood();
            } else {
                e.target.classList.remove('error');
            }
            currentGrid[r][c] = val;
            checkWin();
        }

        function triggerBlood() {
            document.body.classList.add('shake-screen');
            bloodOverlay.style.opacity = '1';
            setTimeout(() => {
                document.body.classList.remove('shake-screen');
                bloodOverlay.style.opacity = '0';
            }, 300);
        }

        function checkWin() {
            for(let r=0; r<9; r++) for(let c=0; c<9; c++) 
                if(currentGrid[r][c] === 0 || !isValid(currentGrid, r, c, currentGrid[r][c])) return;
            
            messageElement.textContent = "ğŸ† çµ•ä¸–é«˜æ‰‹ï¼Œç›¤é¢æ—‹è½‰è¿æ¥å‹åˆ©ï¼";
            startCelebration();
        }

        function startCelebration() {
            container.classList.add('rotate-win');
            celebrationOverlay.style.display = 'block';
            confetti({ particleCount: 200, spread: 90, origin: { y: 0.7 } });

            for (let i = 0; i < 10; i++) {
                const santa = document.createElement('div');
                santa.className = 'santa-sleigh';
                santa.textContent = 'ğŸ…ğŸ»';
                santa.style.top = (Math.random() * 60) + 'vh';
                const speed = 10 + Math.random() * 5;
                const delay = Math.random() * 5;
                santa.style.transition = `left ${speed}s linear ${delay}s`;
                celebrationOverlay.appendChild(santa);

                let giftTimer = setInterval(() => {
                    const rect = santa.getBoundingClientRect();
                    if (rect.left > window.innerWidth) return clearInterval(giftTimer);
                    
                    const gift = document.createElement('div');
                    gift.className = 'gift-item';
                    gift.textContent = ITEMS[Math.floor(Math.random() * ITEMS.length)];
                    gift.style.left = (rect.left + 50) + 'px';
                    gift.style.top = rect.top + 'px';
                    gift.style.color = COLORS[Math.floor(Math.random() * COLORS.length)];
                    celebrationOverlay.appendChild(gift);
                }, 150);

                setTimeout(() => { santa.style.left = '120vw'; }, 100);
            }
        }

        document.getElementById('solve-button').onclick = () => {
            tauntOverlay.style.opacity = '1';
            setTimeout(() => {
                tauntOverlay.style.opacity = '0';
                currentGrid = initialGrid.map(row => [...row]);
                solveSudoku(currentGrid);
                render();
                messageElement.textContent = "çœŸçš„å«©ï¼Œé€£æƒ³éƒ½ä¸æƒ³ã€‚";
            }, 1500);
        };

        document.getElementById('new-game-button').onclick = initGame;

        initGame();
    </script>
</body>
</html>
